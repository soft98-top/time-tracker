# 反思总结功能

## 功能概述

反思总结功能允许用户在专注状态结束后记录和回顾专注成果，支持 Markdown 格式编辑和预览。

## 主要特性

### 1. 悬浮式输入界面
- 🎯 **悬浮模态框**：反思输入框以悬浮窗口形式显示，不干扰主界面
- 📖 **最小化功能**：可以最小化窗口，保持专注状态下的简洁界面
- ✕ **随时关闭**：可以随时关闭反思窗口，内容会自动保存

### 2. Markdown 支持
- ✏️ **实时编辑**：支持 Markdown 语法编辑
- 👁️ **实时预览**：一键切换编辑和预览模式
- 🎨 **丰富格式**：支持标题、列表、粗体、斜体、代码块、链接等

### 3. 智能保存
- 💾 **自动保存**：输入内容后自动保存（2秒延迟）
- 🔄 **实时同步**：内容变化实时同步到历史记录
- ✅ **保存状态**：清晰显示保存状态和未保存提示

### 4. 用户体验优化
- 🚀 **自动打开**：进入反思状态时自动打开反思窗口
- 🔘 **手动控制**：可以手动关闭和重新打开反思窗口
- 📱 **响应式设计**：适配桌面端和移动端

## 使用流程

1. **开始专注** → 点击"开始专注"按钮
2. **切换到反思** → 专注时间达到后，点击"反思"按钮
3. **自动打开反思窗口** → 系统自动打开悬浮式反思输入框
4. **编写反思内容** → 使用 Markdown 格式记录专注成果
5. **预览和编辑** → 可以在编辑和预览模式间切换
6. **自动保存** → 内容自动保存到历史记录中

## 界面控制

### 反思窗口控件
- **预览/编辑** - 切换编辑和预览模式
- **➖** - 最小化窗口
- **📖** - 展开最小化的窗口  
- **✕** - 关闭窗口

### 状态指示器
- **⏳ 正在自动保存...** - 内容正在保存中
- **✓ 已保存** - 内容已成功保存

## 历史记录集成

### 反思总结显示
- 📝 **记录标识**：包含反思总结的记录会显示特殊标识
- 📖 **详情查看**：在历史记录详情中可以查看完整的反思内容
- 🎨 **Markdown 渲染**：历史记录中正确渲染 Markdown 格式

### 数据结构
```typescript
interface SessionRecord {
  // ... 其他字段
  reflectionSummary?: {
    content: string;        // Markdown 内容
    createdAt: number;      // 创建时间
    updatedAt: number;      // 更新时间
  };
}
```

## 技术实现

### 核心组件
- **ReflectionModal** - 悬浮式反思输入模态框
- **ReflectionInput** - 基础反思输入组件（保留用于其他场景）

### 依赖库
- **react-markdown** - Markdown 渲染支持
- **React Hooks** - 状态管理和副作用处理

### 数据持久化
- 扩展了 `SessionRecord` 接口支持反思总结
- 更新了 `HistoryService` 提供反思总结管理方法
- 集成到 `TimerContext` 中统一管理

## 响应式设计

### 桌面端
- 大尺寸模态框，充分利用屏幕空间
- 丰富的控制按钮和状态指示器

### 移动端
- 适配小屏幕的紧凑布局
- 触摸友好的按钮尺寸
- 优化的输入体验

### 深色主题
- 完整支持深色主题
- 自动适配系统主题偏好

## 使用建议

1. **及时记录**：专注结束后立即记录想法，趁记忆清晰
2. **结构化记录**：使用 Markdown 格式组织内容，便于后续回顾
3. **定期回顾**：通过历史记录功能定期回顾反思内容
4. **持续改进**：根据反思内容调整专注策略和方法

## 快捷操作

- **Ctrl/Cmd + Enter** - 快速保存（计划中）
- **Esc** - 关闭反思窗口（计划中）
- **Tab** - 在编辑和预览间切换（计划中）